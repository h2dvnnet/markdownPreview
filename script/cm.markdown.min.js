!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("markdown",function(b,c){function f(c){if(a.findModeByName){var d=a.findModeByName(c);d&&(c=d.mime||d.mimes[0])}var e=a.getMode(b,c);return"null"==e.name?null:e}function r(a,b,c){return b.f=b.inline=c,c(a,b)}function s(a,b,c){return b.f=b.block=c,c(a,b)}function t(a){return!a||!/\S/.test(a.string)}function u(a){return a.linkTitle=!1,a.em=!1,a.strong=!1,a.strikethrough=!1,a.quote=0,a.indentedCode=!1,d||a.f!=w||(a.f=B,a.block=v),a.trailingSpace=0,a.trailingSpaceNewLine=!1,a.prevLine=a.thisLine,a.thisLine=null,null}function v(a,b){var d=a.sol(),e=b.list!==!1,g=b.indentedCode;b.indentedCode=!1,e&&(b.indentationDiff>=0?(b.indentationDiff<4&&(b.indentation-=b.indentationDiff),b.list=null):b.indentation>0?(b.list=null,b.listDepth=Math.floor(b.indentation/4)):(b.list=!1,b.listDepth=0));var i=null;if(b.indentationDiff>=4)return a.skipToEnd(),g||t(b.prevLine)?(b.indentation-=4,b.indentedCode=!0,h.code):null;if(a.eatSpace())return null;if((i=a.match(n))&&i[1].length<=6)return b.header=i[1].length,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,z(b);if(!(t(b.prevLine)||b.quote||e||g)&&(i=a.match(o)))return b.header="="==i[0].charAt(0)?1:2,c.highlightFormatting&&(b.formatting="header"),b.f=b.inline,z(b);if(a.eat(">"))return b.quote=d?1:b.quote+1,c.highlightFormatting&&(b.formatting="quote"),a.eatSpace(),z(b);if("["===a.peek())return r(a,b,F);if(a.match(j,!0))return b.hr=!0,h.hr;if((t(b.prevLine)||e)&&(a.match(k,!1)||a.match(l,!1))){var p=null;return a.match(k,!0)?p="ul":(a.match(l,!0),p="ol"),b.indentation=a.column()+a.current().length,b.list=!0,b.listDepth++,c.taskLists&&a.match(m,!1)&&(b.taskList=!0),b.f=b.inline,c.highlightFormatting&&(b.formatting=["list","list-"+p]),z(b)}return c.fencedCodeBlocks&&(i=a.match(q,!0))?(b.fencedChars=i[1],b.localMode=f(i[2]),b.localMode&&(b.localState=b.localMode.startState()),b.f=b.block=x,c.highlightFormatting&&(b.formatting="code-block"),b.code=!0,z(b)):r(a,b,b.inline)}function w(a,b){var c=e.token(a,b.htmlState);return(d&&null===b.htmlState.tagStart&&!b.htmlState.context&&b.htmlState.tokenize.isInText||b.md_inside&&a.current().indexOf(">")>-1)&&(b.f=B,b.block=v,b.htmlState=null),c}function x(a,b){return a.sol()&&b.fencedChars&&a.match(b.fencedChars,!1)?(b.localMode=b.localState=null,b.f=b.block=y,null):b.localMode?b.localMode.token(a,b.localState):(a.skipToEnd(),h.code)}function y(a,b){a.match(b.fencedChars),b.block=v,b.f=B,b.fencedChars=null,c.highlightFormatting&&(b.formatting="code-block"),b.code=!0;var d=z(b);return b.code=!1,d}function z(a){var b=[];if(a.formatting){b.push(h.formatting),"string"==typeof a.formatting&&(a.formatting=[a.formatting]);for(var d=0;d<a.formatting.length;d++)b.push(h.formatting+"-"+a.formatting[d]),"header"===a.formatting[d]&&b.push(h.formatting+"-"+a.formatting[d]+"-"+a.header),"quote"===a.formatting[d]&&(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(h.formatting+"-"+a.formatting[d]+"-"+a.quote):b.push("error"))}if(a.taskOpen)return b.push("meta"),b.length?b.join(" "):null;if(a.taskClosed)return b.push("property"),b.length?b.join(" "):null;if(a.linkHref?b.push(h.linkHref,"url"):(a.strong&&b.push(h.strong),a.em&&b.push(h.em),a.strikethrough&&b.push(h.strikethrough),a.linkText&&b.push(h.linkText),a.code&&b.push(h.code)),a.header&&b.push(h.header,h.header+"-"+a.header),a.quote&&(b.push(h.quote),!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(h.quote+"-"+a.quote):b.push(h.quote+"-"+c.maxBlockquoteDepth)),a.list!==!1){var e=(a.listDepth-1)%3;e?1===e?b.push(h.list2):b.push(h.list3):b.push(h.list1)}return a.trailingSpaceNewLine?b.push("trailing-space-new-line"):a.trailingSpace&&b.push("trailing-space-"+(a.trailingSpace%2?"a":"b")),b.length?b.join(" "):null}function A(a,b){return a.match(p,!0)?z(b):void 0}function B(b,d){var f=d.text(b,d);if("undefined"!=typeof f)return f;if(d.list)return d.list=null,z(d);if(d.taskList){var i="x"!==b.match(m,!0)[1];return i?d.taskOpen=!0:d.taskClosed=!0,c.highlightFormatting&&(d.formatting="task"),d.taskList=!1,z(d)}if(d.taskOpen=!1,d.taskClosed=!1,d.header&&b.match(/^#+$/,!0))return c.highlightFormatting&&(d.formatting="header"),z(d);var j=b.sol(),k=b.next();if("\\"===k&&(b.next(),c.highlightFormatting)){var l=z(d),n=h.formatting+"-escape";return l?l+" "+n:n}if(d.linkTitle){d.linkTitle=!1;var o=k;"("===k&&(o=")"),o=(o+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var p="^\\s*(?:[^"+o+"\\\\]+|\\\\\\\\|\\\\.)"+o;if(b.match(new RegExp(p),!0))return h.linkHref}if("`"===k){var q=d.formatting;c.highlightFormatting&&(d.formatting="code");var r=z(d),t=b.pos;b.eatWhile("`");var u=1+b.pos-t;return d.code?u===g?(d.code=!1,r):(d.formatting=q,z(d)):(g=u,d.code=!0,z(d))}if(d.code)return z(d);if("!"===k&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return b.match(/\[[^\]]*\]/),d.inline=d.f=D,h.image;if("["===k&&b.match(/.*\](\(.*\)| ?\[.*\])/,!1))return d.linkText=!0,c.highlightFormatting&&(d.formatting="link"),z(d);if("]"===k&&d.linkText&&b.match(/\(.*\)| ?\[.*\]/,!1)){c.highlightFormatting&&(d.formatting="link");var l=z(d);return d.linkText=!1,d.inline=d.f=D,l}if("<"===k&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=C,c.highlightFormatting&&(d.formatting="link");var l=z(d);return l?l+=" ":l="",l+h.linkInline}if("<"===k&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){d.f=d.inline=C,c.highlightFormatting&&(d.formatting="link");var l=z(d);return l?l+=" ":l="",l+h.linkEmail}if("<"===k&&b.match(/^(!--|\w)/,!1)){var v=b.string.indexOf(">",b.pos);if(-1!=v){var x=b.string.substring(b.start,v);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x)&&(d.md_inside=!0)}return b.backUp(1),d.htmlState=a.startState(e),s(b,d,w)}if("<"===k&&b.match(/^\/\w*?>/))return d.md_inside=!1,"tag";var y=!1;if(!c.underscoresBreakWords&&"_"===k&&"_"!==b.peek()&&b.match(/(\w)/,!1)){var A=b.pos-2;if(A>=0){var B=b.string.charAt(A);"_"!==B&&B.match(/(\w)/,!1)&&(y=!0)}}if("*"===k||"_"===k&&!y)if(j&&" "===b.peek());else{if(d.strong===k&&b.eat(k)){c.highlightFormatting&&(d.formatting="strong");var r=z(d);return d.strong=!1,r}if(!d.strong&&b.eat(k))return d.strong=k,c.highlightFormatting&&(d.formatting="strong"),z(d);if(d.em===k){c.highlightFormatting&&(d.formatting="em");var r=z(d);return d.em=!1,r}if(!d.em)return d.em=k,c.highlightFormatting&&(d.formatting="em"),z(d)}else if(" "===k&&(b.eat("*")||b.eat("_"))){if(" "===b.peek())return z(d);b.backUp(1)}if(c.strikethrough)if("~"===k&&b.eatWhile(k)){if(d.strikethrough){c.highlightFormatting&&(d.formatting="strikethrough");var r=z(d);return d.strikethrough=!1,r}if(b.match(/^[^\s]/,!1))return d.strikethrough=!0,c.highlightFormatting&&(d.formatting="strikethrough"),z(d)}else if(" "===k&&b.match(/^~~/,!0)){if(" "===b.peek())return z(d);b.backUp(2)}return" "===k&&(b.match(/ +$/,!1)?d.trailingSpace++:d.trailingSpace&&(d.trailingSpaceNewLine=!0)),z(d)}function C(a,b){var d=a.next();if(">"===d){b.f=b.inline=B,c.highlightFormatting&&(b.formatting="link");var e=z(b);return e?e+=" ":e="",e+h.linkInline}return a.match(/^[^>]+/,!0),h.linkInline}function D(a,b){if(a.eatSpace())return null;var d=a.next();return"("===d||"["===d?(b.f=b.inline=E("("===d?")":"]"),c.highlightFormatting&&(b.formatting="link-string"),b.linkHref=!0,z(b)):"error"}function E(a){return function(b,d){var e=b.next();if(e===a){d.f=d.inline=B,c.highlightFormatting&&(d.formatting="link-string");var f=z(d);return d.linkHref=!1,f}return b.match(J(a),!0)&&b.backUp(1),d.linkHref=!0,z(d)}}function F(a,b){return a.match(/^([^\]\\]|\\.)*\]:/,!1)?(b.f=G,a.next(),c.highlightFormatting&&(b.formatting="link"),b.linkText=!0,z(b)):r(a,b,B)}function G(a,b){if(a.match(/^\]:/,!0)){b.f=b.inline=H,c.highlightFormatting&&(b.formatting="link");var d=z(b);return b.linkText=!1,d}return a.match(/^([^\]\\]|\\.)+/,!0),h.linkText}function H(a,b){return a.eatSpace()?null:(a.match(/^[^\s]+/,!0),void 0===a.peek()?b.linkTitle=!0:a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),b.f=b.inline=B,h.linkHref+" url")}function J(a){return I[a]||(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),I[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")")),I[a]}var d=a.modes.hasOwnProperty("xml"),e=a.getMode(b,d?{name:"xml",htmlMode:!0}:"text/plain");void 0===c.highlightFormatting&&(c.highlightFormatting=!1),void 0===c.maxBlockquoteDepth&&(c.maxBlockquoteDepth=0),void 0===c.underscoresBreakWords&&(c.underscoresBreakWords=!0),void 0===c.taskLists&&(c.taskLists=!1),void 0===c.strikethrough&&(c.strikethrough=!1),void 0===c.tokenTypeOverrides&&(c.tokenTypeOverrides={});var g=0,h={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"tag",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var i in h)h.hasOwnProperty(i)&&c.tokenTypeOverrides[i]&&(h[i]=c.tokenTypeOverrides[i]);var j=/^([*\-_])(?:\s*\1){2,}\s*$/,k=/^[*\-+]\s+/,l=/^[0-9]+([.)])\s+/,m=/^\[(x| )\](?=\s)/,n=c.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,o=/^ *(?:\={1,}|-{1,})\s*$/,p=/^[^#!\[\]*_\\<>` "'(~]+/,q=new RegExp("^("+(c.fencedCodeBlocks===!0?"~~~+|```+":c.fencedCodeBlocks)+")[ \\t]*([\\w+#]*)"),I=[],K={startState:function(){return{f:v,prevLine:null,thisLine:null,block:v,htmlState:null,indentation:0,inline:B,text:A,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(b){return{f:b.f,prevLine:b.prevLine,thisLine:b.thisLine,block:b.block,htmlState:b.htmlState&&a.copyState(e,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,formatting:!1,linkTitle:b.linkTitle,code:b.code,em:b.em,strong:b.strong,strikethrough:b.strikethrough,header:b.header,hr:b.hr,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,indentedCode:b.indentedCode,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside,fencedChars:b.fencedChars}},token:function(a,b){if(b.formatting=!1,a!=b.thisLine){var c=b.header||b.hr;if(b.header=0,b.hr=!1,a.match(/^\s*$/,!0)||c){if(u(b),!c)return null;b.prevLine=null}b.prevLine=b.thisLine,b.thisLine=a,b.taskList=!1,b.trailingSpace=0,b.trailingSpaceNewLine=!1,b.f=b.block;var d=a.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,e=4*Math.floor((d-b.indentation)/4);e>4&&(e=4);var f=b.indentation+e;if(b.indentationDiff=f-b.indentation,b.indentation=f,d>0)return null}return b.f(a,b)},innerMode:function(a){return a.block==w?{state:a.htmlState,mode:e}:a.localState?{state:a.localState,mode:a.localMode}:{state:a,mode:K}},blankLine:u,getType:z,fold:"markdown"};return K},"xml"),a.defineMIME("text/x-markdown","markdown")});