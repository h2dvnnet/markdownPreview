function update(a){setOutput(a.getValue()),clearTimeout(hashto),hashto=setTimeout(updateHash,1e3)}function setOutput(a){a=a.replace(/<equation>((.*?\n)*?.*?)<\/equation>/gi,function(a,b){return'<img src="http://latex.codecogs.com/png.latex?'+encodeURIComponent(b)+'" />'});var b=document.getElementById("out"),c=b.cloneNode(!0);b.innerHTML=md.render(a),emojify.run(b);var d=c.getElementsByTagName("*");if(void 0!==d){var e=b.getElementsByTagName("*");if(void 0!==e)for(var f=0,g=Math.min(d.length,e.length);g>f;f++)if(!d[f].isEqualNode(e[f]))return void(b.scrollTop=e[f].offsetTop)}}function saveAsMarkdown(){save(editor.getValue(),"untitled.md")}function saveAsHtml(){save(document.getElementById("out").innerHTML,"untitled.html")}function save(a,b){var c=new Blob([a],{type:"text/plain"});if(window.saveAs)window.saveAs(c,b);else if(navigator.saveBlob)navigator.saveBlob(c,b);else{url=URL.createObjectURL(c);var d=document.createElement("a");d.setAttribute("href",url),d.setAttribute("download",b);var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),d.dispatchEvent(e)}}function showMenu(){menuVisible=!0,menu.style.display="block"}function hideMenu(){menuVisible=!1,menu.style.display="none"}function updateHash(){window.location.hash=btoa(RawDeflate.deflate(unescape(encodeURIComponent(editor.getValue()))))}var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;var languageOverrides={js:"javascript",html:"xml"};emojify.setConfig({img_dir:"emoji"});var md=markdownit({html:!0,highlight:function(a,b){if(languageOverrides[b]&&(b=languageOverrides[b]),b&&hljs.getLanguage(b))try{return hljs.highlight(b,a).value}catch(c){}return""}}).use(markdownitFootnote),hashto,editor=CodeMirror.fromTextArea(document.getElementById("code"),{mode:"gfm",lineNumbers:!0,lineWrapping:!0,tabSize:2,styleActiveLine:!0,matchBrackets:!0,theme:"base16-light",extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}});editor.on("change",update),document.addEventListener("drop",function(a){a.preventDefault(),a.stopPropagation();var b=new FileReader;b.onload=function(a){editor.setValue(a.target.result)},b.readAsText(a.dataTransfer.files[0])},!1),document.getElementById("saveas-markdown").addEventListener("click",function(){saveAsMarkdown(),hideMenu()}),document.getElementById("saveas-html").addEventListener("click",function(){saveAsHtml(),hideMenu()});var menuVisible=!1,menu=document.getElementById("menu");if(document.getElementById("close-menu").addEventListener("click",function(){hideMenu()}),document.addEventListener("keydown",function(a){return 83==a.keyCode&&(a.ctrlKey||a.metaKey)?(a.shiftKey?showMenu():saveAsMarkdown(),a.preventDefault(),!1):27===a.keyCode&&menuVisible?(hideMenu(),a.preventDefault(),!1):void 0}),window.location.hash){var h=window.location.hash.replace(/^#/,"");"view:"==h.slice(0,5)?(setOutput(decodeURIComponent(escape(RawDeflate.inflate(atob(h.slice(5)))))),document.body.className="view"):(editor.setValue(decodeURIComponent(escape(RawDeflate.inflate(atob(h))))),update(editor),editor.focus())}else update(editor),editor.focus();